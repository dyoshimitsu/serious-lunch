language: ruby
rvm:
  - 2.5.0
sudo: required
dist: trusty
services:
  - docker
env:
  global:
  - RAILS_ENV: test
cache: bundler
bundler_args: --without production --deployment --path=vendor/bundle
before_install:
  - gem update --system
  - gem --version
  - sudo service mysql stop
    && $TRAVIS_BUILD_DIR/scripts/travis_start_containers.sh
    && $TRAVIS_BUILD_DIR/scripts/travis_wait_containers.sh mysql
    && ln -s /var/run/mysqld/mysqld.sock "${DATABASE_SOCKET:-/tmp/mysql.sock}"
script:
  - bin/rails db:drop db:create db:migrate RAILS_ENV=test
  - bundle exec rubocop
  - bundle exec rspec
after_success:
  - $TRAVIS_BUILD_DIR/scripts/travis_production_deploy.sh
